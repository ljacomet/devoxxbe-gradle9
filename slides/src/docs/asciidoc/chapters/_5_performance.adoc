[background-color="#02303a"]
== Build scalability
image::gradle/bg-7.png[background, size=cover]

&#x1F680;

=== Build scalability
image::gradle/bg-6.png[background, size=cover]

Gradle vision

Gradle Build Tool is an open-source build system
that automates the process of building software of
any type, size, or complexity in a fast and reliable manner

=== Build scalability
image::gradle/bg-6.png[background, size=cover]

Gradle vision

Gradle Build Tool is an open-source build system
that automates the process of building software of
any type, *size, or complexity in a fast* and reliable *manner*

[background-color="#02303a"]
=== Guiding principles
image::gradle/bg-7.png[background, size=cover]

[.notes]
****
Alex
****

[%notitle]
=== Guiding principles
image::gradle/bg-7.png[background, size=cover]

> Overhead should be proportional to the impact of the change

=== Prioritization based on use-cases
image::gradle/bg-7.png[background, size=cover]

[%step]
* Inner developer loop
** Code, Build and Test
* Outer developer loop
** Sync
** Integrate
*** Stateful CI/CD
*** Ephemeral CI/CD

=== Gradle build anatomy
image::gradle/bg-7.png[background, size=cover]

image::gradle-build-anatomy.png[]

[.small.right.top-margin]
*Bars not to scale*

[background-color="#02303a"]
=== Primary strategies
image::gradle/bg-7.png[background, size=cover]

=== Performance focus
image::gradle/bg-7.png[background, size=cover]

[%step]
* Work avoidance
* Parallelism

=== Execution work avoidance
image::gradle/bg-7.png[background, size=cover]

* Up-to-date tasks
* Output caching
** Tasks
** And more
** Local and remote
* Incremental tasks

=== Execution work avoidance with Develocity
image::gradle/bg-7.png[background, size=cover]

* Remote caching of outputs
* Predictive test selection

=== Execution parallelism
image::gradle/bg-7.png[background, size=cover]

* Parallel task execution
* Worker API
* Parallel test execution

=== Execution parallelism with Develocity
image::gradle/bg-7.png[background, size=cover]

* Test Distribution

[background-color="#02303a"]
=== Configuration work avoidance
image::gradle/bg-7.png[background, size=cover]

=== Gradle Configuration Cache
image::gradle/bg-7.png[background, size=cover]

* The Configuration Cache is
[%step]
** a feature that significantly improves the inner developer loop performance
** by caching the result of the configuration phase
** and reusing this for subsequent builds.

=== What is cached?
image::gradle/bg-7.png[background, size=cover]

[%step]
* Task graph
* Task inputs
* All the rest is discarded
** No `project` state anymore

=== Example of invalid input
image::gradle/bg-7.png[background, size=cover]

[source,kotlin]
----
abstract class SomeTask : DefaultTask() {

    @get:Input lateinit var sourceSet: SourceSet

    @TaskAction
    fun action() {
        val classpathFiles = sourceSet.compileClasspath.files
        // Do something with the files
    }
}
----

needs to become

[source,kotlin]
----
abstract class SomeTask : DefaultTask() {

    @get:InputFiles @get:Classpath
    abstract val classpath: ConfigurableFileCollection

    @TaskAction
    fun action() {
        val classpathFiles = classpath.files
        // Do something with the files
    }
}
----

configured with

[source,kotlin]
----
classpath.from(sourceSet.compileClasspath)
----

[background-color="#02303a"]
=== Demo
image::gradle/bg-7.png[background, size=cover]

[.notes]
****
* sooner
* intra project parallel
****

=== Additional benefits
image::gradle/bg-7.png[background, size=cover]

[%step]
* Better parallelism at execution
** Intra project task parallelism
* Reduced memory usage on CC hits
** No configuration state is created

=== Can I use it on my build?
image::gradle/bg-7.png[background, size=cover]

[%step]
* It depends on your build
** You may have to refactor custom build-logic
* Most widely plugins out there are already compatible
* You can selectively declare incompatible tasks +
[.small]#`tasks.some { notCompatibleWithConfigurationCache("because") }`#

* This is about applying best practices anyway

[.notes]
****
* The amount of required work will directly depend on the 3rd party plugins you use and the amount of custom build logic you have.
****

=== Configuration Cache Report
image::gradle/bg-7.png[background, size=cover]

[%step]
* Useful to understand CC inputs
* Built-in
* image:cc-report-inputs.png[width=80%]

=== Configuration Cache Report
image::gradle/bg-7.png[background, size=cover]

[%step]
* Useful to understand CC problems
* Got much nicer in Gradle 8.7 with filtered exceptions
* image:cc-report-problems.png[]

=== Space Usage Analysis
image::gradle/bg-7.png[background, size=cover]

[%step]
* Useful if your cached state is too big
* External tool link:https://github.com/gradle/gcc2speedscope[gradle/gcc2speedscope]
* Helps identify "task state leaks"
* image:gcc2speedscope.png[width=80%]

=== What performance benefits?
image::gradle/bg-7.png[background, size=cover]

[%step]
* It depends on your build
* It's not only about avoiding the configuration phase
* All tasks will run in parallel, always
* Configuration model memory can be freed
* Small builds will mostly benefit from more parallelism
* Large builds will also benefit from avoided configuration

=== What performance benefits?
image::gradle/bg-7.png[background, size=cover]

[%step]
* For example: Square, on a *large* Android build
* Early adopters - link:https://developer.squareup.com/blog/5-400-hours-a-year-saving-developers-time-and-sanity-with-gradles/[Blog Post] - December 2022
* _Saving 5,400 hours a year with Gradle's Configuration Cache_
* _Recovering an estimated $1.1 million in lost productivity annually_
